#!/usr/bin/make -f
# Copyright (C) 2009 Julian Andres Klode <jak@debian.org>
#
# Free Software, licensed under the GPL-2 or (at your option) any later version.

APT_PKG  = $(shell sed -nr 's/set\(MAJOR ([^)]*).*/\1/p' apt-pkg/CMakeLists.txt)
APT_INST = $(shell sed -nr 's/set\(MAJOR.([^)]*).*/\1/p' apt-inst/CMakeLists.txt)
export LDFLAGS = -Wl,--as-needed


%:
	dh --buildsystem=cmake $@

override_dh_install:
	dh_install --fail-missing
	
override_dh_auto_clean:
	dh_auto_clean --buildsystem=cmake
	rm -rf debian/shlibs.local*

override_dh_gencontrol: debian/shlibs.local
	echo "libapt-pkg:provides=libapt-pkg$(APT_PKG)" >> debian/apt.substvars
	echo "libapt-inst:provides=libapt-inst$(APT_INST)" >> debian/apt-utils.substvars
	dh_gencontrol

debian/shlibs.local:
	rm -rf $@ $@.apt $@.apt-utils
	echo "libapt-pkg $(APT_PKG)" > $@.apt
	echo "libapt-pkg $(APT_PKG) libapt-pkg$(APT_PKG)" > $@.apt-utils
	echo "libapt-inst $(APT_INST)" >> $@.apt-utils
	echo "libapt-pkg $(APT_PKG) libapt-pkg$(APT_PKG)" > $@
	echo "libapt-inst $(APT_INST) libapt-inst$(APT_INST)" >> $@

override_dh_shlibdeps: debian/shlibs.local
	dh_shlibdeps
