
set -e

TESTDIR=$(readlink -f $(dirname $0))
. $TESTDIR/framework

setupenvironment
configarchitecture 'amd64' 'i386'

buildsimplenativepackage 'testing' 'amd64' '0.1' 'stable'
buildsimplenativepackage 'testing' 'all' '0.8.15' 'stable'
buildsimplenativepackage 'testing2' 'amd64,i386' '0.8.15' 'stable'
setupaptarchive 

# install native
exec 3> apt-progress.log
testsuccess aptget install testing=0.1 -y -o APT::Status-deb822-Fd=3
testequal "# and compare
testequal "percent:0
message: Running dpkg

package: testing2
percent: 0
message: Installing testing2 (i386)

package: testing2
percent: 20
message: Preparing testing2 (i386)

package: testing2
percent: 40
message: Unpacking testing2 (i386)

package: testing2
percent: 60
message: Preparing to configure testing2 (i386)

percent: 60
message: Running dpkg

package: testing2
percent: 60
message: Configuring testing2 (i386)

package: testing2
percent: 80
message: Configuring testing2 (i386)

package: testing2
percent: 100
message: Installed testing2 (i386)" cat apt-progress.log


rm -f apt-progress*.log
